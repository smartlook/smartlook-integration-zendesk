APP={},APP.init=function(){var t=ZAFClient.init();t.invoke("resize",{width:"100%",height:"210px"}),t.get("ticket.requester.id").then(function(e){var s=e["ticket.requester.id"];APP.getUser(t,s)})},APP.getSessions=function(t,e,s){var i={url:"https://www.smartlook.com/api/sessions.list",type:"POST",data:{apiKey:e,filters:{visitorEmail:s||""},sorters:{timeStart:-1}}};t.request(i).then(function(e){APP.showSessions(t,e)},function(t){APP.showError(t)})},APP.getUser=function(t,e){var s={url:"/api/v2/users/"+e+".json",type:"GET",dataType:"json"};t.request(s).then(function(e){t.metadata().then(function(s){APP.getSessions(t,s.settings["API token"],e.user.email)})},function(t){APP.showError(t)})},APP.showSessions=function(t,e){if(void 0===e.sessions||!e.sessions.length)return APP.templateCompile({},"noRecordings-template"),void t.invoke("resize",{width:"100%",height:"80px"});var s={sessions:e.sessions};APP.templateCompile(s,"main-template")},APP.showError=function(t){var e={status:t.status,statusText:t.statusText};APP.templateCompile(e,"error-template")},APP.templateCompile=function(t,e){var s=$("#"+e).html(),i=Handlebars.compile(s)(t);$("#content").html(i)},$(function(){APP.init()});